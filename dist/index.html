<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Arch. / Inf. Migration on the FE</title>
    <style>
    :root {
        --mainColor: #f06d06;
        --textColor: #ffffff;
    }

    body {
        padding: 0;
        margin: 2em;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        font-size: 13px;
    }

    .wrapper {
        margin: 0 auto;
    }

    table {
        width: 100%;
        max-width: 1920px;
        border-collapse: collapse;
        margin: 2em auto 0;
    }

    tr:nth-child(even) {
        background-color: #f6f8fa;
    }

    th,
    td {
        vertical-align: top;
        padding: 2em 1em;
    }

    th {
        text-align: left;
        border-bottom: solid 1px lightgray;
        font-size: 1.1em;
    }

    td {
        border-bottom: solid 1px rgb(240, 240, 240);
    }

    td:first-child {
        font-weight: 600;
        color: tomato;
    }

    .proposed a {
        font-weight: 600;
        color: yellowgreen;
    }

    p {
        margin: .5em auto 1em;
        padding: 0;
        font-size: 16px;
        line-height: 1.5em;
        word-wrap: break-word;
        /* font-family: Georgia, 'Times New Roman', Times, serif; */
        color: #24292C;
        max-width: 980px;
    }

    h1 {
        margin: 0 auto;
        max-width: 980px;
        border-bottom: 1px solid #24292C;
        padding-bottom: 0.3em;
    }

    h2 {
        margin: 1.5em auto 0;
        padding-bottom: 0.3em;
        font-size: 1.5em;
        border-bottom: 1px solid #eaecef;
        max-width: 980px;
    }

    h3 {
        margin: 1.5em auto 0;
        padding-bottom: 0.3em;
        border-bottom: 1px solid #eaecef;
        max-width: 980px;
    }

    /* .alt-package,
    .alt-package a {
        color: gray;
    } */

    ul {
        max-width: 980px;
        margin: 0 auto;
        font-size: 16px;
        line-height: 1.5em;
        color: #24292C;
    }

    table ul {
        margin: 0;
        padding: 0;
        font-size: inherit;
    }

    table ul li {
        margin-bottom: .5em;
    }

    .nowrap {
        white-space: nowrap;
    }

    hr {
        height: .25em;
        padding: 0;
        margin: 24px 0;
        background-color: #e1e4e8;
        border: 0;
    }

    .color-test-bar {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1em;
        margin: 0 auto;
        background: var(--mainColor);
        width: 100%;
        max-width: 960px;
        height: 50px;
    }

    #choose-theme-color {
        margin-right: 1em;
    }

    .color-test-bar span {
        color: var(--textColor);
    }

    nav {
        width: 980px;
        margin: 1em auto 0;
    }

    nav ul {
        padding: 0;
    }

    nav ul li {
        display: inline-block;
        margin-right: 1em;
        font-size: 1em;
    }

    nav ul li a {
        color: tomato;
        text-decoration: none;
        border-bottom: dotted 1px tomato;
    }

    .to-top a {
        font-size: 3.5em;
        position: fixed;
        bottom: .5em;
        right: 2em;
        opacity: .3;
        transition: opacity .2s ease;
        color: gray;
        text-decoration: none;
    }

    .to-top a:hover {
        opacity: .75;
    }

    pre {
        margin: 0 auto;
        max-width: 980px;
        padding: 16px;
        overflow: auto;
        line-height: 1.45;
        background-color: #f6f8fa;
        border-radius: 3px;
    }
    </style>
</head>

<body>
    <!-- <div class="to-top"><a href="#">⇡</a></div> -->
    <div class="wrapper">
        <h1>Bullseye: Architecture & Infrastructure Migration on the FE</h1>
        <nav>
            <ul>
                <li><a href="#mission">Mission</a></li>
                <li><a href="#infrastructure">Infrastructure</a></li>
                <li><a href="#application">Application</a></li>
                <li><a href="#libraries">Libraries</a></li>
                <li><a href="#styles">Styles</a></li>
                <li><a href="#cleanup">Cleanup</a></li>
            </ul>
        </nav>
        <h2 id="mission">Mission</h2>
        <p>
            We require a fully portable, practical and modern update to our current Front-End infrastructure. </p>
        <p>
            Important elements of our system architecture including environments and base packages are antiquated and/or unsupported. They also do not offer the benefits of modern systems/packages that could streamline our development processes in a multitude of ways. A shift towards a more modern and mature architecture would allow us to leverage these benefits and more.</p>
        <p>An attractive toolset and contemporary methodology would also assist with resourcing on the FE.</p>
        <p>At a macro-scale, this would likely mean moving away from Scale Factory as our SysOps provider, leaving us with the option to either find another — more reliable — provider, or 'go it alone' and manage systems in-house. The former could be expensive, and the latter would need to be a well monitored and automated solution and would potentially require resourcing. From a Front-End perspective, a updated infrastructure would allow us to use modern, reliable and supported packages and frameworks. This would improve system stability, application speed and reduce complexity.</p>
        <p>The process would have to be done iteratively, so it's important that library choices are based on their ability to integrate with our current framework. Pros and cons of all frameworks, including Angular 2+ should be considered.</p>
        <h2 id="infrastructure">Infrastructure migration table</h2>
        <p>Bear in mind <i>none</i> of these tools are bleeding-edge. However they will all bring us up-to-date with current industry standards (and all the benefits associated).
            <br>Moving to some of these tools will remove the need for multiple packages and plugins for single functionality, thereby consolidating the functionality of our FE infrastructure.
        </p>
        <table>
            <tr>
                <th>
                    Functionality
                </th>
                <th>
                    Current
                </th>
                <th>
                    Proposed
                </th>
                <th>
                    Benefits
                </th>
                <th>
                    Current Version / Longevity
                </th>
                <th>
                    License
                </th>
                <th class="nowrap">
                    Est. Human Cost
                </th>
                <th>
                    Comments
                </th>
            </tr>
            <tr>
                <td class="nowrap">Package Management</td>
                <td class="nowrap">Bower 1.8.4
                    <br>
                    <br>NPM 2.15.8 (Node 4.4.7)</td>
                <td class="proposed"><a href="//nodejs.org">NPM</a></td>
                
                <td>
                    <ul>
                        <li>
                            Bower has been deprecated by its creators
                        </li>
                        <li>
                            Bower has a separate, smaller package ecosystem containing outdated versions of packages
                        </li>
                        <li>
                            NPM Is a single place for all app & development packages
                        </li>
                        <li>
                            NPM saves space, avoids dependency conflicts
                        </li>
                    </ul>
                </td>
                <td>NPM v6+ (Node v10+)
                    <br>
                    <br>Very much currently industry standard. Still being developed and maintained, has over 2K contributors.
                    <br>
                    <br><a href="https://github.com/ry">Ryan Dahl</a>, the creator of Node.js, is creating a new type of node using TypeScript
                </td>
                <td>OS</td>
                <td></td>
                <td>See: <a href="//snyk.io/blog/bower-is-dead">Bower is dead, long live npm. And Yarn. And webpack</a>
                    <br>
                    <br>Migration should ideally run alongside task-runner/bundler migration. If not, we can adapt Gulp tasks to leverage NPM packages instead of Bower ones.
                </td>
            </tr>
            <tr>
                <td class="nowrap">Task Runner / Bundler</td>
                <td class="nowrap">Gulp 3.9.1</td>
                <td class="proposed"><a href="//webpack.js.org">Webpack</a></td>
                <td>
                    <ul>
                        <li>Removes need for large, potentially buggy Gulp tasks</li>
                        <li>Webpack supports dev server, source-maps, minification, hot reloading natively</li>
                        <li>Built to manage large-scale applications</li>
                        <li>Webpack gives us a dependency graph, leveraging modular JS for dynamic loading (or 'Stop being a human compiler. Use a dependency graph.')</li>
                        <li>Easy to configure ES6+ support</li>
                        <li>Tree shaking (dead asset elimination)</li>
                    </ul>
                </td>
                <td>
                    v4+
                    <br>
                    <br>Webpack is maintained mostly by <a href="https://github.com/sokra">one person</a>, but is well respected (43K stars on Github), <a href="https://stackshare.io/webpack/in-stacks">used by big-hitters</a>, and the current industry standard bundler
                </td>
                <td>OS</td>
                <td></td>
                <td><a href="https://blog.andrewray.me/webpack-when-to-use-and-why/">Webpack: When To Use And Why</a></td>
            </tr>
            <tr class="alt-package">
                <td></td>
                <td></td>
                <td class="proposed"><a href="//parceljs.org">ParcelJS</a></td>
                <td>
                    <ul>
                        <li>Very simple config, quick to get up and running</li>
                        <li>Lots of built-in goodness</li>
                    </ul>
                </td>
                <td>v1.9.7
                    <br>
                    <br>The new kid on the block; _very_ easy to configure. Looks v exciting for the future, but still a little bit young compared to Webpack.
                </td>
                <td>OS</td>
                <td></td>
                <td>See: <a href="http://tinyurl.com/y85d9s93">If you’ve ever configured Webpack, Parcel will blow your mind!</a></td>
            </tr>
            <tr>
                <td class="nowrap">Testing
                    <br>(Unit, Integration, Coverage)</td>
                <td class="nowrap">Karma 1.7.1
                    <br>
                    <br>Mocha 3.5.3 (Sinon, Chai)</td>
                <td class="proposed"><a href="//jestjs.io">Jest</a></td>
                <td>
                    <ul>
                        <li>Minimal setup & configuration</li>
                        <li>Native assertion library and mocking support, as well as chai support</li>
                        <li>Does away with the need for multiple dodgy plugins</li>
                        <li>Good IDE integration</li>
                    </ul>
                </td>
                <td>v23.3
                    <br>
                    <br>Created by Facebook. Still under active development. Another 'new kid' compared to what we currently use, but being adopted fast due to it's benefits over older frameworks.
                </td>
                <td>OS</td>
                <td></td>
                <td>See: <a href="http://tinyurl.com/ybpx2p6e">An Overview of JavaScript Testing in 2018</a></td>
            </tr>
            <tr>
                <td class="nowrap">Testing
                    <br>(E2E)</td>
                <td class="nowrap">Protractor 3.3.0</td>
                <td class="proposed"><a href="//devexpress.github.io/testcafe">TestCafe</a></td>
                <td>
                    <ul>
                        <li>No plugins - does everything out of the box</li>
                        <li>Built-in test recorder for test script generation</li>
                        <li>Compatible with all known CIs</li>
                        <li>Great analysis tools and reports</li>
                    </ul>
                </td>
                <td>v0.21.1
                    <br>
                    <br> Ok - so it's a bit youthful. Everywhere you turn, people recommend using this tool due to it's simple setup, syntax and test recorder. Definitely worth looking into.
                </td>
                <td>OS</td>
                <td></td>
                <td>See: <a href="https://www.sitepoint.com/testcafe-easier-end-end-web-app-testing-node-js/">TestCafe: Easier End-to-end Web App Testing with Node.js</a></td>
            </tr>
            <tr>
                <td class="nowrap">Linting / Error Checking</td>
                <td class="nowrap">JShint 2.9.4
                    <br>
                    <br>JSCS 1.13.1</td>
                <td class="proposed"><a href="//eslint.org">ESLint</a></td>
                <td>
                    <ul>
                        <li>ESLint: Simple configuration and output</li>
                        <li>Good ES6 & React Support</li>
                        <li>Combines code style and error checking</li>
                        <li>Highly configurable</li>
                        <li>JSHint: confusing rules!</li>
                        <li>Basic ES6 support, no React support</li>
                        <li>JSCS code style checker only</li>
                    </ul>
                </td>
                <td>v5.4.0
                    <br>
                    <br> Now industry standard linter. Great support across the board. Actively maintained and growing.
                </td>
                <td>OS</td>
                <td></td>
                <td>See: <a href="https://objectcomputing.com/resources/publications/sett/january-2017-eslint-dont-write-javascript-without-it/">ESLINT, DON'T WRITE JAVASCRIPT WITHOUT IT!</a></td>
            </tr>
        </table>
        <h3>Notes</h3>
        <p><em>TrackJS:</em> After a bit of investigation, there is one reasonable competitor in the error-tracking market, <a href="https://sentry.io/welcome/">Sentry</a></p>
        <p>The basic plan is free, but doesn't provide the features we have with TrackJS ($49p/m), although Sentry's cheapest plan($26p/m) does seem to, and offers better data retention than TrackJS (90 days vs 14 days). They do have a slightly weird 'per-error' billing structure, but we don't get near enough errors to go over the line… currently.</p>
        <p>If finance is an issue here, we could move over. Personal preference would be to stay where we are. TrackJS supports everything we need right now, and can support other frameworks just as easily. Feels like a move sideways.</p>
        <h2 id="application">Application migration table</h2>
        <p>Frameworks for consideration
        </p>
        <table>
            <tr>
                <th>
                    Functionality
                </th>
                <th>
                    Current
                </th>
                <th>
                    Proposed
                </th>
                <th>
                    Benefits
                </th>
                <th>
                    Current Version / Longevity
                </th>
                <th>
                    License
                </th>
                <th class="nowrap">
                    Est. Human Cost
                </th>
                <th>
                    Comments
                </th>
            </tr>
            <tr>
                <td>Application Framework</td>
                <td class="nowrap">AngularJS 1.5</td>
                <td class="proposed"><a href="//reactjs.org">React</a></td>
                <td>
                    <ul>
                        <li>Emphasis on code and component reuse</li>
                        <li>Declarative. Handles state v nicely - and separately from components</li>
                        <li>Industry standard for large apps</li>
                        <li>Uses 'Virtual DOM' that updates only the elements required, alleviating performance issues</li>
                        <li>Speed; significantly faster that AngularJS when dealing with large amounts of data and complex views</li>
                        <li>BIG ecosystem. Many up-to-date, maintained, top quality plugins. Lots of support, examples, training content etc etc.</li>
                        <li>One-way data flow. Single source of truth</li>
                        <li>Emphasis on functional programming rather than OOP</li>
                        <li>'Personelle resourcing' would be somewhat easier</li>
                    </ul>
                </td>
                <td>v16+
                    <br>
                    <br>
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
            <tr class="alt-package">
                <td></td>
                <td></td>
                <td class="proposed"><a href="//angular.io">Angular</a></td>
                <td>
                    <ul>
                        <li></li>
                    </ul>
                </td>
                <td>v6
                    <br>
                    <br> Barrier might be that Angular uses Typescript natively, meaning a pretty steep new learning curve.
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
            <tr class="alt-package">
                <td></td>
                <td></td>
                <td class="proposed"><a href="//vuejs.org">Vue.js</a></td>
                <td>
                    <ul>
                        <li>Super-simple compared to React</li>
                    </ul>
                </td>
                <td>v2.5.17
                    <br>
                    <br> _Very_ popular, growing at an insane rate. Less fully-featured than React. Considered best for small-medium apps.
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
        </table>
        <h2 id="libraries">Library migration table</h2>
        <p>This table includes replacements for libs curently in-use, and new introductions.
        </p>
        <table>
            <tr>
                <th>
                    Functionality
                </th>
                <th>
                    Current
                </th>
                <th>
                    Proposed
                </th>
                <th>
                    Benefits
                </th>
                <th>
                    Current Version / Longevity
                </th>
                <th>
                    License
                </th>
                <th class="nowrap">
                    Est. Human Cost
                </th>
                <th>
                    Comments
                </th>
            </tr>
            <tr>
                <td>Tables</td>
                <td class="nowrap">"stableTable": in-house table solution</td>
                <td class="proposed"><a href="//">ReactTable</a></td>
                <td>
                    <ul>
                        <li></li>
                    </ul>
                </td>
                <td>v16+
                    <br>
                    <br>
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Maps</td>
                <td class="nowrap">Angular Google Maps 2.4 (Google Maps API wrapper)</td>
                <td class="proposed"><a href="//"></a></td>
                <td>
                    <ul>
                        <li></li>
                    </ul>
                </td>
                <td>v16+
                    <br>
                    <br>
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Report charts</td>
                <td class="nowrap">D3-based in-house solution</td>
                <td class="proposed"><a href="//"></a></td>
                <td>
                    <ul>
                        <li></li>
                    </ul>
                </td>
                <td>v16+
                    <br>
                    <br>
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Notifications</td>
                <td class="nowrap">none<em> (explicitly requested / long poll only)</em></td>
                <td class="proposed"><a href="//"></a></td>
                <td>
                    <ul>
                        <li></li>
                    </ul>
                </td>
                <td>v16+
                    <br>
                    <br>
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Icons</td>
                <td class="nowrap">FontAwesome</td>
                <td class="proposed"><a href="//">FontAwesome5</a></td>
                <td>
                    <ul>
                        <li></li>
                    </ul>
                </td>
                <td>v16+
                    <br>
                    <br>
                </td>
                <td>OS</td>
                <td></td>
                <td></td>
            </tr>
        </table>
        <h2 id="styles">Changes to Bullseye Style repo and deployment</h2>
        <h3>Background</h3>
        <p>Overall, the styles repo and toolset are a good fit. We are, however, missing any kind of error-checking / linting for our Sass. Currently, error-checking is human — when a PR is being reviewed — and code-style isn't enforced at all. This can be tackled by implementing Stylelint in the dev and server envionments. This would allow for a strict coding style to be enforced, which would be very beneficial for daily development and new starters, as well as allowing us to tidy up our current codebase.</p>
        <p>We are currently hindered by having the Bullseye Style repo deployment coupled with that of the API. This path was taken due to the need for the API to compile the SCSS to CSS using white-label colors from the database, and logo assets from AWS. The stylesheets are then cached until such time as the base stylesheet changes, or WL data is updated. Ideally, app styles and the API should not touch one another <em>at all</em>.</p>
        <h3>Issues</h3>
        <ul>
            <li>No separation of concerns; app styles are entwined with the API, including deployment (which feels weird and dirty)</li>
            <li>Multiple stylesheets exist, one for each white label iteration of the platform</li>
            <li>Extra legwork for the API to handle</li>
            <li>Sometimes stylesheets are compiled at runtime, hence the need for our annoying 'fade-in' screen whenever a hard-reload is triggered. We are literally just waiting for a stylesheet in that time.</li>
        </ul>
        <h3>
            Solutions
        </h3>
        <p>Using CSS3 custom properties we can change colours in pre-loaded CSS, on-the-fly, via Javascript. This would be <em>far more sensible</em>:</p>
        <ul>
            <li>Removes the need for a separate styles repo completely. All .scss files would live in the <code>src\css</code> folder (where they're supposed to be!); Styles are deployed with the UI, not API</li>
            <li>A single global stylesheet exists for all iterations of the platform</li>
            <li>Allow live colour changes in the UI using variables</li>
            <li>Admedo brand colours are embedded in the stylesheet (via static Sass variables, still easy to change) and overridden for white labels at runtime.</li>
            <li>Broadens the spectrum of usable colours. We can accurately calculate appropriate body text contrast based on background colour via JS. Now you CAN have that pure white navbar! :-D</li>
        </ul>
        <h3>
            Live colour changes using variables
        </h3>
        <p>Check it out for yrsel ;)</p>
        <div class="color-test-bar">
            <input type="color" value="#f6b73c" id="choose-theme-color"><span>Click box & choose a colour :-p</span>
            <p></p>
        </div>
        <h3>Notes</h3>
        <p>See: <a href="https://www.smashingmagazine.com/2018/05/css-custom-properties-strategy-guide/">https://www.smashingmagazine.com/2018/05/css-custom-properties-strategy-guide/</a>
            <a href="https://medium.com/geckoboard-under-the-hood/how-we-made-our-product-more-personalized-with-css-variables-and-react-b29298fde608">https://medium.com/geckoboard-under-the-hood/how-we-made-our-product-more-personalized-with-css-variables-and-react-b29298fde608</a></p>
        <p>LOGOS! FE assets? how to do this? Look at other things above first.</p>
        <h2 id="cleanup">Cleanup</h2>
        <p>tidying up blah etc</p>
        <p>Remove unused packages Sensible folder structure</p>
    </div>
    <script>
    var colorInput = document.querySelector("#choose-theme-color");
    colorInput.addEventListener("change", function() {
        document.documentElement.style.setProperty("--mainColor", this.value);
        document.documentElement.style.setProperty("--textColor", getCorrectTextColor(this.value));
    });

    function getCorrectTextColor(hex) {
        var threshold = 130;
        var hRed = hexToR(hex);
        var hGreen = hexToG(hex);
        var hBlue = hexToB(hex);

        function hexToR(h) {
            return parseInt((cutHex(h)).substring(0, 2), 16)
        }

        function hexToG(h) {
            return parseInt((cutHex(h)).substring(2, 4), 16)
        }

        function hexToB(h) {
            return parseInt((cutHex(h)).substring(4, 6), 16)
        }

        function cutHex(h) {
            return (h.charAt(0) == "#") ? h.substring(1, 7) : h
        }

        cBrightness = ((hRed * 299) + (hGreen * 587) + (hBlue * 114)) / 1000;
        if (cBrightness > threshold) {
            return "#000000";
        } else {
            return "#ffffff";
        }
    }
    </script>
</body>

</html>